<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:sx="http://www.stixy.com/v1.0" lang="en">
<head>
  <title>JavaScript unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script type="text/javascript">
    var StixyError = function(e){
      throw(e);
    }
    var STIXY_ENV = 'test';
  </script>
  
  <script src="../../public/javascripts/all/default/001_prototype_extend.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/002_stixy_init.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/003_events.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/004_elements.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/005_str_html_xml.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/006_board.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/007_flash.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/008_features_init.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/009_features_move.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/010_features_resize.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/011_features_hover.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/012_features_focus.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/013_features_order.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/014_features_remove.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/015_features_text.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/016_features_upload.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/017_scroll.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/018_effects.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/027_popup.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/028_server.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/029_ui.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/030_widgets.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/031_tools.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/032_widgets_optionbar.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/default/033_event_observers.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/widgets/document.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/widgets/note.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/widgets/photo.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/widgets/todo.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../public/javascripts/all/stixyboard/001_event_observers.js" type="text/javascript" charset="utf-8"></script>
  
  <script src="assets/jsunittest.js" type="text/javascript"></script>
  <link rel="stylesheet" href="assets/unittest.css" type="text/css" />
  <link rel="stylesheet" href="../../public/stylesheets/all/default/010_popup.css" type="text/css" media="screen" title="no title" charset="utf-8">
  
  <link rel="stylesheet" href="../../public/stylesheets/all/widgets/101_default.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="../../public/stylesheets/all/widgets/102_document.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="../../public/stylesheets/all/widgets/103_note.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="../../public/stylesheets/all/widgets/104_photo.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="../../public/stylesheets/all/widgets/105_todo.css" type="text/css" media="screen" title="no title" charset="utf-8">
  
</head>
<body>

<div id="content">

  <div id="header">
    <h1>Read and write editor commands</h1>
  </div>

  <!-- Log output (one per Runner, via {testLog: "testlog"} option)-->
  <div id="testlog"></div>
  
  <!-- Put or load sample/test html here (load via sampleLoad(file) in setup() methods) -->
  <div class="canvas" id="stixyboard">

    <div class="canvas-content" id="canvas_content">
      
      <div id="widget_1" style="top: 39px; left: 38px; width: 195px; height: 238px; z-index: 1000012;" class="note widget  ">
        <div class="shadow"><s><a> </a></s><b><i><a> </a></i><u><a> </a></u></b></div>
        <div class="focus">
        	<div class="focus-border-spacer"> </div>
        </div>
      	<div class="base">
          <div style="" class="base-bg note-bg"><p></div>
          <div class="editor-bg"><div class="editor-bg-border"> </div></div>
      		<div class="editor-canvas">
      		  <div contenteditable="true" class="editor" id="editor"><sx:moz-editor-spacer><div></div></sx:moz-editor-spacer>
      		    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      		  </div>
      		</div>
      		<div class="handles">
      	    <div class="remove"></div>
          	<div class="resizer"></div>
          </div>
      	</div>
      </div>
      
      <div id="widget_2" style="top: 339px; left: 38px; width: 195px; height: 238px; z-index: 1000012;" class="note widget  ">
        <div class="shadow"><s><a> </a></s><b><i><a> </a></i><u><a> </a></u></b></div>
        <div class="focus">
        	<div class="focus-border-spacer"> </div>
        </div>
      	<div class="base">
          <div style="" class="base-bg note-bg"><p></div>
          <div class="editor-bg"><div class="editor-bg-border"> </div></div>
      		<div class="editor-canvas">
      		  <div contenteditable="true" class="editor" id="editor2"><sx:moz-editor-spacer><div></div></sx:moz-editor-spacer>
      		    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
      		  </div>
      		</div>
      		<div class="handles">
      	    <div class="remove"></div>
          	<div class="resizer"></div>
          </div>
      	</div>
      </div>
      
  </div>
</div>
	
<script type="text/javascript">
// <![CDATA[
  
  Stixy.listen('ready', function(){
      
      var getTrimmedSelection = function(){
        return getSelection().toString().replace(/\n/,' ');
      }
      
      var selectWord = function(word, node){
        with(this){
          var offset = node.data.search(new RegExp(word));
          range.setStart(node, offset);
          range.setEnd(node, offset+word.length);
          getSelection().removeAllRanges();
          getSelection().addRange(range);
          //assertEqual(word, getTrimmedSelection());
        }
      }
       console.log(1)
   		     
      var widget = Stixy.widgets.addWidget(new Stixy.widgets.Note("widget_1"));
      var widget2 = Stixy.widgets.addWidget(new Stixy.widgets.Note("widget_2"));
      
      new Test.Unit.Runner({

        // replace this with your real tests
        setup: function() {
          range = document.createRange();
        },

        teardown: function() {
          //range.detach();
        },
        
        testReadAndWrite: function() {
          selectWord.b(this)('ipsum', widget.text.source.lastChild);
          var commandValues = { fontsize:6, forecolor:'#222', fontname:'Verdana', hilitecolor:'#ee3355' };
          var commandStates = ["justifyright", "bold", "italic", "underline", "strikethrough", "insertunorderedlist"];

          commandStates.eachProperty(function(property,value){
    			  document.execCommand(value,false,true);
          })
          commandValues.eachProperty(function(property,value){
    			  document.execCommand(property,false,value);
    			})
          
      		var node = widget.text.findTextNode(widget.text.source, /ipsum/)

          selectWord.b(this)('ipsum', node);
          var storedValues = widget.text.getEditorValues();

          widget2.text.resetFormating();

          selectWord.b(this)('ipsum', widget2.text.source.lastChild);
          widget2.text.setEditorValues(storedValues);
        }
        

      }, {testLog: "testlog"}); 
      // For each Test.UnitRunner instance, specify the element id where results will be
      // published; e.g. <div id="testlog"/> above.
      // That is, you can have multiple "new Test.Unit.Runner() { ... }" on this page, just
      // create more <div id="testlog2"></div> etc, and pass the element id to the hash above:
      // e.g. {testLog: "testlog2"}
    // ]]>
    
  })
</script>
</body>
</html>